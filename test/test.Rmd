---
title: "test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Set root directory of all chunks to current working directory.
# !!! NOTE: Change this to your directory if needed.
knitr::opts_knit$set(root.dir = getwd())

library(igraph)
library(ggplot2)
library(reshape2)
library(dplyr)
library(tidyr)
# library(logger)
# library(parallel)
# library(readr)
library(rlang)
library(tictoc)
library(data.table)
library(netrb)
library(Matrix)
library(pbapply)

# Read example graphs from file.
# Read example graphs from file.
graphs <- list(
  pg = read_graph('networks/power-grid.txt',
                  format   = 'edgelist',
                  directed = FALSE),
  ir = read_graph('networks/internet-routers.txt',
                  format   = 'edgelist',
                  directed = FALSE),
  cr = read_graph('networks/roads-ca.txt',
                  format   = 'edgelist',
                  directed = FALSE),
  wa = read_graph('networks/eurosis-webatlas.graphml',
                  format   = 'graphml')
)
# Pre-calculate diameters of graphs, via igraph, Gephi, etc,
# since initializing a station_graph requires this,
# and it is computationally expensive
diams <- list(pg = 46,
              ir = 11,
              cr = 849,
              wa = 10)
```

```{r}
# TODO delete and try w/ actual package.
# Import all `.R` files from the `R/` directory.
r_source_dir  <- sprintf('%s/R', dirname(getwd()))
r_source_file_paths <- list.files(r_source_dir, full.names = TRUE)
# Run `source()` on each source file path to import.
invisible(sapply(r_source_file_paths, source))
set.seed(0)
# g <- sample_pa(1e5)
sim <- simulator(g        = graphs$wa,
                 .name    = 'test_wa',
                 diam     = diams$wa,
                 from_scratch = FALSE)

set.seed(1)
# g <- sample_gnm(100, 200)
# # plot(g)x
# sim_gnm <- simulator(g,
#                      .name = 'test_gnm_100_200')
vcount(graphs$wa)


```


```{r}
# fvd <- metric_vs_del(sim, 
#                          integrity,
#                          vcount_orig = vcount(graphs$wa),
#                          attrs = c('rand', 'clos'),
#                          nchunks = 4)

```
```{r}
# plot_Ys_vs_X(fvd)


```

```{r}
tic()
set.seed(-10)
g <- graphs$ir
s1 <- sample(vcount(g), 100)
# set.seed(-2)
# s2 <- sample(vcount(g), 10)
d <- distances(g, v=s1, to=s1)
rownames(d) <- s1
colnames(d) <- s1
toc()

```

```{r}
tic()
set.seed(1)
g <- graphs$cr
x1 <- order(centr_eigen(g)$vector, decreasing = TRUE)
# x2 <- order(page_rank(graphs$cr)$vector, decreasing = TRUE)
# x3 <- order(degree(g), decreasing = TRUE)
# x <- page_rank(g,
#               vids = sample(1:vcount(g), 1e3))
# y <- centr_eigen(g)
toc()
```

```{r}
max(degree(graphs$cr))#, x2[1:10])
```
```{r}
x1[1:10]
```


```{r}
degree(graphs$ir, v = x2[1:10])
```

```{r}

tic()
set.seed(1)
tt <- sample(5e6)
trow <- as.list(tt)
tcol <- matrix(tt, ncol = 1)
fwrite(trow, "row.csv", col.names = FALSE)
fwrite(tcol, "col.csv", col.names = FALSE)
toc()
```
```{r}
tic()
# rr <- as.matrix(fread("col.csv"))
d2 <- fread("dists.csv")
toc()
```

```{r}
tic()
rc <- fread("row.csv")
toc()
```


```{r}
# TODO replace ALL `rs` with `sim`.
res <- metric_vs_del(
  sim,
  integrity,
  attrs = c('rand', 'eign'),
  del_max = 0.5,
  vcount_orig = vcount(graphs$cr),
  nchunks = 10
)
res
```





```{r}
plot_metric_vs_del(res, 'a')
```

