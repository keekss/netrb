---
title: "test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Set root directory of all chunks to current working directory.
# !!! NOTE: Change this to your directory if needed.
knitr::opts_knit$set(root.dir = getwd())

library(igraph)
library(ggplot2)
library(reshape2)
library(dplyr)
library(tidyr)
# library(logger)
# library(parallel)
# library(readr)
library(rlang)
library(tictoc)
library(data.table)
library(netrb)
library(Matrix)
library(pbapply)

# Read example graphs from file.
graphs <- list(
  pg = read_graph('networks/power_grid.txt',
                  format   = 'edgelist',
                  directed = FALSE),
  ir = read_graph('networks/internet_routers.txt',
                  format   = 'edgelist',
                  directed = FALSE),
  cr = read_graph('networks/roads_ca.txt',
                  format   = 'edgelist',
                  directed = FALSE)
)
# Pre-calculate diameters of graphs, via igraph, Gephi, etc,
# since initializing a station_graph requires this,
# and it is computationally expensive
diams <- list(pg = 46,
              ir = 11,
              cr = 849)
```

```{r}
# TODO delete and try w/ actual package.
# Import all `.R` files from the `R/` directory.
r_source_dir  <- sprintf('%s/R', dirname(getwd()))
r_source_file_paths <- list.files(r_source_dir, full.names = TRUE)
# Run `source()` on each source file path to import.
invisible(sapply(r_source_file_paths, source))
set.seed(0)
g <- sample_pa(1e5)

sim <- simulator(g,#        = graphs$pg,
                 .name    = 'test_sim',
                 # diam     = diams$pg,
                 name_is_new = FALSE)
```


```{r}
# TODO replace ALL `rs` with `sim`.
res <- func_vs_deletions(
  sim,
  integrity,
  attrs = c('rand', 'eign', 'clos'),
  del_max = 0.2,
  vcount_orig = vcount(g),
  nchunks = 4
)
res
```


```{r}
delete_simulator(sim)
```


```{r}
df <- as.data.frame(t(res))
p <- ggplot(data = df, aes(x = del_frac, y = rand)) +
  geom_line()
for (i in 2:ncol(df)) {
  p <- p + geom_line(aes(y = df[,i]))
}
df
```

